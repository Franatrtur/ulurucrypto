/*
LICENSED UNDER THE MIT LICENSE: https://github.com/Franatrtur/ulurucrypto/blob/main/LICENSE
*/
var Uluru;"undefined"==typeof module&&"undefined"==typeof global||(global.crypto=global.crypto||require("crypto")||void 0),function(t){let e;!function(t){t.Ascii=class{encode(t){let e=new Uint8Array(t.length);for(let n=0,r=t.length;n<r;n++)e[n]=t.charCodeAt(n);return e}decode(t){return String.fromCharCode(...t)}}}(e=t.enc||(t.enc={}))}(Uluru||(Uluru={})),function(t){let e;!function(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=["","=","=="],r=new Uint8Array(256);for(let t=0;t<64;t++)r[e.charCodeAt(t)]=t;t.Base64=class{encode(e){if("function"==typeof atob)return(new t.Ascii).encode(atob(e));let n,i,s=3*(e=e.replace(/[^A-Za-z0-9\+\/]/g,"")).length+1>>>2,a=new Uint8Array(s),o=0,c=0;for(let t=0,h=e.length;t<h;t++)if(i=3&t,o|=r[e.charCodeAt(t)]<<6*(3-i),3==i||e.length-t==1){for(n=0;n<3&&c<s;n++,c++)a[c]=o>>>(16>>>n&24)&255;o=0}}decode(r){if("function"==typeof btoa)return btoa((new t.Ascii).decode(r));let i=[],s=2,a=0;for(let t=0,n=r.length;t<n;t++)s=t%3,a=r[t]<<(16>>>s&24),2!=s&&r.length-t!=1||(i.push(e.charAt(a>>>18&63)+e.charAt(a>>>12&63)+e.charAt(a>>>6&63)+e.charAt(63&a)),a=0);return i.join("").slice(0,i.length-2+s)+n[2-s]}}}(e=t.enc||(t.enc={}))}(Uluru||(Uluru={})),function(t){const e=new Uint32Array((new t.enc.Ascii).encode("expand 32-byte k").buffer);t.ChaCha20=class{constructor(t,n=!0,r=0,i=0){this.state=new Uint32Array(16),this.state.set(e),this.state.set(new Uint32Array(t.buffer,t.byteOffset,t.byteLength>>2),4),this.state[13]=r;for(let t=0;t<8;t++){for(let t=0;t<4;t++)this.QR(this.state,t,t+4,t+8,t+12);for(let t=0;t<16;t+=4)this.QR(this.state,t,t+1,t+2,t+3)}this.prectr=this.state[15],this.state[15]^=i,this.ctr=i,this.domac=!!n,this.reset()}reset(){this.xstate=new Uint32Array(16),this.pmac=!!this.domac&&new Uint32Array(e),this.cmac=!!this.domac&&new Uint32Array(e),this.data=new Uint32Array(0),this.pointer=0,this.sigbytes=0}QR(t,e,n,r,i){t[e]+=t[n],t[i]^=t[e],t[i]=t[i]<<16|t[i]>>>16,t[r]+=t[i],t[n]^=t[r],t[n]=t[n]<<12|t[n]>>>20,t[e]+=t[n],t[i]^=t[e],t[i]=t[i]<<8|t[i]>>>24,t[r]+=t[i],t[n]^=t[r],t[n]=t[n]<<7|t[n]>>>25}getmac(){if(!this.domac)return!1;let t=this.pmac,e=this.cmac,n=new Uint32Array([t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]);for(let t=0;t<4;t++)this.QR(n,0,1,2,3),this.QR(n,3,0,1,2),this.QR(n,2,3,0,1),this.QR(n,1,2,3,0);for(let r=0;r<4;r++)n[r]+=t[r]+e[r];return new Uint8Array(n.buffer)}process(t=!1){let e,n,r=(t?Math.ceil:Math.floor)((this.sigbytes-this.pointer)/16),i=Math.ceil(this.sigbytes/4)-1,s=4-this.sigbytes%4;this.state[15]=this.prectr^this.ctr+(this.pointer>>4);for(let t=0;t<r;t++){let t=this.xstate;t.set(this.state);for(let e=0;e<20;e+=2)this.QR(t,0,4,8,12),this.QR(t,1,5,9,13),this.QR(t,2,6,10,14),this.QR(t,3,7,11,15),this.QR(t,0,5,10,15),this.QR(t,1,6,11,12),this.QR(t,2,7,8,13),this.QR(t,3,4,9,14);for(let t=0;t<16&&this.pointer+t<=i;t++)n=(e=this.data[this.pointer+t])^this.xstate[t]+this.state[t],this.pointer+t==i&&(n=n<<8*s>>>8*s),this.data[this.pointer+t]=n,this.domac&&(this.pmac[3&t]^=e+this.xstate[t],this.cmac[3&t]^=n+this.xstate[t],this.QR(this.pmac,3&t,t+1&3,t+2&3,t+3&3),this.QR(this.cmac,3&t,t+1&3,t+2&3,t+3&3));this.pointer+=16,this.state[15]++}}append(e){e="string"==typeof e?(new t.enc.Utf8).encode(e):e;let n=this.data,r=64*Math.ceil((this.sigbytes+e.byteLength)/64);this.data=new Uint8Array(r),this.data.set(new Uint8Array(n.buffer,0,this.sigbytes)),this.data.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.sigbytes),this.data=new Uint32Array(this.data.buffer),this.sigbytes+=e.byteLength}update(t){return this.append(t),this.process(!1),this}finalize(){return this.process(!0),{data:new Uint8Array(this.data.buffer,0,this.sigbytes),mac:this.getmac()}}}}(Uluru||(Uluru={})),function(t){t.encrypt=function(e,n){let r="object"==typeof crypto?crypto.getRandomValues(new Uint32Array(1))[0]:Math.floor(4294967296*Math.random()),i=new t.Pbkdf(32,1e3).compute((new t.enc.Utf8).encode(n),r).result,s=new t.ChaCha20(i,!0,r);s.update((new t.enc.Utf8).encode(e));let a=s.finalize();return(new t.enc.Hex).decode(new Uint8Array(new Uint32Array([r]).buffer))+(new t.enc.Base64).decode(a.data)+(new t.enc.Hex).decode(a.mac)},t.decrypt=function(e,n){let r,i,s;try{r=new Uint32Array((new t.enc.Hex).encode(e.slice(0,8)).buffer)[0],i=(new t.enc.Base64).encode(e.slice(8,-32)),s=e.slice(-32)}catch(t){throw"Incorrectly formated ciphertext"}let a=new t.Pbkdf(32,1e3).compute((new t.enc.Utf8).encode(n),r).result,o=new t.ChaCha20(a,!0,r);o.update(i);let c=o.finalize();if((new t.enc.Hex).decode(c.mac)!=s)throw"Invalid authentication";return(new t.enc.Utf8).decode(c.data)},t.hash=function(e){return(new t.Keccak800).update((new t.enc.Utf8).encode(e)).finalize().toString(new t.enc.Hex)},t.rsaGenerate=function(){return t.RSAKeyPair.generate(3072).toString()},t.rsaSign=function(e,n){return(new t.enc.Base64).decode(t.RSAKey.fromString(n).sign((new t.enc.Utf8).encode(e)).signature)},t.rsaVerify=function(e,n,r){return t.RSAKey.fromString(r).verify((new t.enc.Utf8).encode(e),(new t.enc.Base64).encode(n))},t.rsaEncrypt=function(e,n){let r=t.RSAKey.fromString(n),i=crypto.getRandomValues(new Uint32Array(8)),s=(new t.enc.Base64).decode(r.encrypt(i).data),a=new t.ChaCha20(i,!0).update((new t.enc.Utf8).encode(e)).finalize();return s+"|"+(new t.enc.Base64).decode(a.data)+(new t.enc.Hex).decode(a.mac)},t.rsaDecrypt=function(e,n){let r,i,s,a,o;try{r=t.RSAKey.fromString(n),o=e.split("|"),i=(new t.enc.Base64).encode(o[0]),s=(new t.enc.Base64).encode(o[1].slice(0,-32)),a=(new t.enc.Hex).encode(o[1].slice(32))}catch(t){throw"Incorrectly formatted RSA ciphertext"}}}(Uluru||(Uluru={})),function(t){let e;!function(t){let e=Array(256),n={};for(let t=0;t<256;t++)e[t]=("00"+t.toString(16)).slice(-2),n[e[t]]=t;t.Hex=class{encode(t){let e=new Uint8Array(t.length>>1);for(let r=0;r<t.length;r+=2)e[r>>1]=n[t.slice(r,r+2)];return e}decode(t){let n=Array(t.length);for(let r=0;r<t.length;r++)n[r]=e[t[r]];return n.join("")}}}(e=t.enc||(t.enc={}))}(Uluru||(Uluru={})),function(t){const e=new Uint8Array([0,1,62,28,27,36,44,6,55,20,3,10,43,25,39,41,45,15,21,8,18,2,61,56,14]),n=new Uint32Array([1,32898,32906,2147516416,32907,2147483649,2147516545,32777,138,136,2147516425,2147483658,2147516555,139,32905,32771,32770,128,32778,2147483658,2147516545,32896,2147483649,2147516424]),r=new Uint8Array(25),i=new Uint8Array(25),s=new Uint8Array(25),a=new Uint8Array(25),o=new Uint8Array(25);let c,h;for(let t=0;t<25;t++)c=t%5,h=Math.floor(t/5),r[t]=(c+1)%5,i[t]=(c+4)%5,s[t]=5*h+(2*c+3*h)%5,a[t]=(c+1)%5*5+h,o[t]=(c+2)%5*5+h;t.Keccak800=class{constructor(){this.reset()}reset(){this.state=new Uint32Array(25),this.temp=new Uint32Array(25),this.theta=new Uint32Array(5),this.data=new Uint32Array(0),this.pointer=0,this.padblock=new Uint32Array(16),this.padsigbytes=0}keccakF(t){let c,h,f=this.temp,l=this.theta;for(let u=0;u<22;u++){l[0]=t[0]^t[1]^t[2]^t[3]^t[4],l[1]=t[5]^t[6]^t[7]^t[8]^t[9],l[2]=t[10]^t[11]^t[12]^t[13]^t[14],l[3]=t[15]^t[16]^t[17]^t[18]^t[19],l[4]=t[20]^t[21]^t[22]^t[23]^t[24];for(let n=0;n<25;n++)h=l[r[n]],t[n]^=l[i[n]]^(h<<1|h>>>31),c=e[n],h=t[n],f[s[n]]=h<<c|h>>>32-c;for(let e=0;e<25;e++)t[e]=f[e]^~f[a[e]]&f[o[e]];t[0]^=n[u]}}process(t=!1){let e=(this.data.length-this.pointer)/16;for(let t=0;t<e;t++){for(let t=0;t<16;t++)this.state[t]^=this.data[this.pointer+t];this.keccakF(this.state),this.pointer+=16}if(t){for(let t=0;t<16;t++)this.state[t]^=this.padblock[t];this.keccakF(this.state)}}append(e){e="string"==typeof e?(new t.enc.Utf8).encode(e):e;let n=this.padblock,r=this.padsigbytes;if(e.byteLength+r<64)(n=new Uint8Array(n.buffer)).set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r),n[n.length-1]=128,n[e.byteLength+r]^=6,this.padblock=new Uint32Array(n.buffer),this.padsigbytes+=e.byteLength;else{let t=r+e.byteLength>>6<<6,i=(r+e.byteLength)%64;this.data=this.data.byteLength>t?new Uint8Array(this.data.buffer,0,t):new Uint8Array(t),this.data.set(new Uint8Array(n.buffer,0,r)),this.data.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength-i),r),this.data=new Uint32Array(this.data.buffer,0,t>>2),n.fill(0),this.padsigbytes=0,i>0&&this.append(new Uint8Array(e.buffer,e.byteOffset+e.byteLength-i,i))}}update(t){return this.append(t),this.process(!1),this}finalize(e=32){this.process(!0);let n=16*Math.ceil(e/64),r=new Uint32Array(n);for(let t=0;t<n;t+=16)r.set(new Uint32Array(this.state.buffer,0,16),t),this.keccakF(this.state);return{toString(e=new t.enc.Hex){return e.decode(this.hash)},hash:new Uint8Array(r.buffer,0,e)}}}}(Uluru||(Uluru={})),function(t){const e=12,n=16,r=e+n+4;function i(...t){let e=0;for(let n=0;n<t.length;n++)e+=t[n].byteLength;let n=new Uint8Array(e),r=0;for(let e=0;e<t.length;e++)n.set(new Uint8Array(t[e].buffer,t[e].byteOffset,t[e].byteLength),r),r+=t[e].byteLength;return n}class s{pad(s,a){let o=new Uint8Array(a-r);o.set(s);let c=new Uint32Array([s.byteLength]),h=crypto.getRandomValues(new Uint8Array(e)),f=i(c,h,(new t.Keccak800).update(o).update(c).update(h).finalize(n).hash),l=(new t.Keccak800).update(f).finalize(a-r).hash;for(let t=0;t<a-r;t++)o[t]^=l[t];l=(new t.Keccak800).update(o).finalize(r).hash;for(let t=0;t<r;t++)f[t]^=l[t];return{data:i(f,o)}}unpad(i){let s=i.byteLength,a=new Uint8Array(i.buffer,0,r).slice(),o=new Uint8Array(i.buffer,r).slice(),c=(new t.Keccak800).update(o).finalize(r).hash;for(let t=0;t<r;t++)a[t]^=c[t];c=(new t.Keccak800).update(a).finalize(s-r).hash;for(let t=0;t<s-r;t++)o[t]^=c[t];let h=new Uint32Array(a.buffer,0,1),f=new Uint8Array(a.buffer,4,e),l=new Uint8Array(a.buffer,4+e,n);if((new t.Keccak800).update(o).update(h).update(f).finalize(n).hash.join(",")!=l.join(","))throw"OAEP invalid padding hash";return{data:new Uint8Array(o.buffer,0,h[0])}}}s.seedlen=e,s.hashlen=n,s.hdrlen=r,t.OAEP=s}(Uluru||(Uluru={})),function(t){t.Pbkdf=class{constructor(t=32,e=1e3){this.outputbytes=t,this.iterations=e}compute(e,n=0){let r,i=new Uint8Array(this.outputbytes),s=new t.Keccak800;s.update(new Uint32Array([n])),s.finalize(0);for(let t=0;t<this.iterations;t++){s.update(e),r=s.finalize(this.outputbytes).hash;for(let t=0;t<i.length;t++)i[t]^=r[t]}return{result:i}}}}(Uluru||(Uluru={})),function(t){class e{constructor(){this.pool=new Uint32Array(e.capacity),this.pointer=0}static get secure(){return"object"==typeof crypto}reset(){if(this.pointer=0,e.secure)crypto.getRandomValues(this.pool);else for(let t=0,e=this.pool.length;t<e;t++)this.pool[t]=Math.floor(4294967296*Math.random())}word(){return this.pointer>=this.pool.length&&this.reset(),this.pool[this.pointer++]}fill(t){if(ArrayBuffer.isView(t)){this.reset();let e=new Uint32Array(t.buffer,t.byteOffset,t.byteLength>>2);for(let t=0,n=e.length;t<n;t+=this.pool.length)e.set(new Uint32Array(this.pool,0,Math.min(n-t,this.pool.length)),t),this.reset();let n=new Uint8Array(t.buffer,t.byteLength>>2<<2,t.byteLength-(t.byteLength>>2<<2));for(let t=0,e=n.length;t<e;t++)n[t]=this.word()}else for(let e=0,n=t.length;e<n;e++)t[e]=this.word();return t}}e.capacity=16300,t.Random=e}(Uluru||(Uluru={})),function(t){const e=BigInt,n=e(1),r=e(0),i=t=>(n<<e(t))-n;function s(t){let n=0,r=e(4294967296),i=!0;for(;t;)n+=(i=i&&t>r)?32:1,t>>=e(i?32:1);return n}function a(t,e,r){let i=n;for(;e;)(e&n)==n&&(i=i*t%r),e>>=n,t=t*t%r;return i}function o(t){let n=r,s="object"==typeof crypto?()=>crypto.getRandomValues(new Uint32Array(1))[0]:Math.random;for(let r=0;32*r<t;r++)n=n<<e(32)|e(s());return n&i(t)}let c=[e(2)];t:for(let t=3;t<1024;t+=2){for(let n=1;n<c.length;n++)if(e(t)%c[n]===BigInt(0))continue t;c.push(e(t))}function h(t,i=6){for(let e=0,n=c.length;e<n;e++)if(t%c[e]==r)return t==c[e];return function(t,i=6){let c,h,f=r,l=t-n,u=Math.min(16,s(t)-1);for(;(l&n)==n;)l>>=n,f++;let d=n,y=t-n;t:for(;i--;)if((h=a(c=o(u)+e(5),l,t))!=d&&h!=y){for(let i=r,s=f-n;i<s;i++){if((h=a(h,e(2),t))==d)return!1;if(h==y)continue t}return!1}return!0}(t,i)&&function(t,r=6){let i,c=Math.min(16,s(t)-1);for(;r--;)if(a(i=o(c)+e(5),t-n,t)!=n)return!1;return!0}(t,i)}function f(t,r=6,i=1e5){let s;for(let a=0;a<i;a++)if(h(s=o(t)|n|n<<e(t-1),r))return s;throw"Cannot find a prime"}function l(n){return e("0x"+(new t.enc.Hex).decode(new Uint8Array(n.buffer,n.byteOffset||0,n.byteLength||0)))}function u(e){let n=e.toString(16);return(new t.enc.Hex).encode((n.length%2==1?"0":"")+n)}class d{constructor(t,n){this.E=e(t),this.M=e(n)}static fromBufferViews(t,e){return new this(l(t),l(e))}static fromString(e){let n=e.split("<")[1].split(">")[0].split("|");return this.fromBufferViews((new t.enc.Base64).encode(n[0]),(new t.enc.Base64).encode(n[1]))}toString(){return"<"+(new t.enc.Base64).decode(u(this.E))+"|"+(new t.enc.Base64).decode(u(this.M))+">"}process(t){let e=l(t);if(e>=this.M)throw"Data integer too large";return u(a(e,this.E,this.M))}encrypt(e){e="string"==typeof e?(new t.enc.Utf8).encode(e):e;let n=(s(this.M)>>3)-2-t.OAEP.hdrlen;if(e.byteLength>n)throw"Message too long";return{data:this.process((new t.OAEP).pad(e,n).data)}}decrypt(e){return{data:(new t.OAEP).unpad(this.process(e)).data}}sign(e){e="string"==typeof e?(new t.enc.Utf8).encode(e):e;(new t.Keccak800).update(e).finalize(64).hash;return{data:e,signature:this.encrypt(e).data}}verify(e,n){e="string"==typeof e?(new t.enc.Utf8).encode(e):e;let r=(new t.Keccak800).update(e).finalize(64).hash,i=this.decrypt(n).data;return r.join(",")==i.join(",")}}t.RSAKey=d;const y=e(257),p=["\n==BEGIN ULURU PUBLIC KEY==\n","\n==END ULURU PUBLIC KEY==\n"],w=["\n==BEGIN ULURU PRIVATE KEY==\n","\n==END ULURU PRIVATE KEY==\n"];class g{constructor(t,e){this.public=t,this.private=e}static fromString(t){return new this(d.fromString(t.split(p[0])[1].split(p[1])[0]),d.fromString(t.split(w[0])[1].split(w[1])[0]))}static generate(t){if(!t)return;let e=y,i=f(t>>=1),s=f(t),a=i*s,o=function(t,e){let i,s,a=e,o=r,c=n;for(;t>1;)i=t/e,s=e,e=t%e,t=s,s=o,o=c-i*o,c=s;return c<0?c+a:c}(e,(i-n)*(s-n));return new this(new d(e,a),new d(o,a))}toString(){return p[0]+this.public.toString()+p[1]+"\n"+w[0]+this.private.toString()+w[1]}}g.pubexp=y,g.publicprefix=p,g.privateprefix=w,t.RSAKeyPair=g}(Uluru||(Uluru={})),function(t){let e;!function(t){t.Utf8=class{encode(t){if("function"==typeof TextEncoder)return(new TextEncoder).encode(t);let e,n=new Uint8Array(4*t.length),r=0;for(let i=0,s=t.length;i<s;i++)(e=t.codePointAt(i))>4096&&i++,e<=127?n[r++]=e:e<=2047?(n[r++]=192|e>>>6&31,n[r++]=128|63&e):e<=65535?(n[r++]=224|e>>>12&15,n[r++]=128|e>>>6&63,n[r++]=128|63&e):(n[r++]=240|e>>>18&7,n[r++]=128|e>>>12&63,n[r++]=128|e>>>6&63,n[r++]=128|63&e)}decode(t){if("function"==typeof TextDecoder)return(new TextDecoder).decode(t);let e,n=[];for(let r=0,i=t.length;r<i;)t[r]<128?n.push(String.fromCharCode(t[r++])):t[r]>=192&&t[r]<224?n.push(String.fromCharCode((31&t[r++])<<6|63&t[r++])):t[r]>=224&&t[r]<240?n.push(String.fromCharCode((15&t[r++])<<12|(63&t[r++])<<6|63&t[r++])):t[r]>=240&&t[r]<247?(e=(7&t[r++])<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++],n.push(String.fromCodePoint(e))):r++;return n.join("")}}}(e=t.enc||(t.enc={}))}(Uluru||(Uluru={})),"undefined"!=typeof module&&(module.exports=Uluru);