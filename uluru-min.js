/*
LICENSED UNDER THE MIT LICENSE: https://github.com/Franatrtur/ulurucrypto/blob/main/LICENSE
*/
!function(t,e){let s="object"==typeof window?window:global,n=Object.assign("object"==typeof s.Uluru?s.Uluru:s.Uluru={},t);"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=n)}(function(){const t=Uint8Array,e=Uint32Array;class s{encode(e){let s=new t(e.length);for(let t=0,n=e.length;t<n;t++)s[t]=e.charCodeAt(t);return s}decode(t){return String.fromCharCode(...t)}}class n{encode(t){return"function"==typeof TextEncoder?(new TextEncoder).encode(t):(new s).encode(unescape(encodeURIComponent(t)))}decode(t){return"function"==typeof TextDecoder?new TextDecoder("utf8").decode(t):decodeURIComponent(escape((new s).decode(t)))}}const i=Array(256),h={};let r;for(let t=0;t<256;t++)r=("00"+t.toString(16)).slice(-2),i[t]=r,h[r]=t;class o{encode(e){let s=new t(e.length>>1);for(let t=0,n=e.length;t<n;t+=2)s[t>>1]=h[e.slice(t,t+2)];return s}decode(t){let e=[];for(let s=0,n=t.length;s<n;s++)e.push(i[t[s]]);return e.join("")}}class a{encode(t){return(new s).encode(atob(t))}decode(t){return btoa((new s).decode(t))}}const c=new e((new s).encode("expand 32-byte k").buffer);class d{reset(){this.xstate=new e(16),this.pmac=!!this.domac&&new e(c),this.cmac=!!this.domac&&new e(c),this.data=new e(0),this.pointer=0,this.sigbytes=0}constructor(t,s=!0,n=0,i=0){this.state=new e(16);let h=this.state;h.set(c),h.set(new e(t.buffer),4),h[13]=n;for(let t=0;t<8;t++){for(let t=0;t<4;t++)this.QR(h,t,t+4,t+8,t+12);for(let t=0;t<16;t+=4)this.QR(h,t,t+1,t+2,t+3)}this.prectr=h[15],h[15]^=i,this.ctr=i,this.domac=!!s,this.reset()}QR(t,e,s,n,i){t[e]+=t[s],t[i]^=t[e],t[i]=t[i]<<16|t[i]>>>16,t[n]+=t[i],t[s]^=t[n],t[s]=t[s]<<12|t[s]>>>20,t[e]+=t[s],t[i]^=t[e],t[i]=t[i]<<8|t[i]>>>24,t[n]+=t[i],t[s]^=t[n],t[s]=t[s]<<7|t[s]>>>25}getmac(){if(!this.domac)return!1;let s=this.pmac,n=this.cmac,i=new e([s[0]^n[0],s[1]^n[1],s[2]^n[2],s[3]^n[3]]);for(let t=0;t<4;t++)this.QR(i,0,1,2,3),this.QR(i,3,0,1,2),this.QR(i,2,3,0,1),this.QR(i,1,2,3,0);for(let t=0;t<4;t++)i[t]+=s[t]+n[t];return new t(i.buffer)}process(t=!1){let e,s,n=(t?Math.ceil:Math.floor)((this.sigbytes-this.pointer)/16),i=Math.ceil(this.sigbytes/4)-1,h=4-this.sigbytes%4;this.state[15]=this.prectr^this.ctr+(this.pointer>>4);for(let t=0;t<n;t++){let t=this.xstate;t.set(this.state);for(let e=0;e<20;e+=2)this.QR(t,0,4,8,12),this.QR(t,1,5,9,13),this.QR(t,2,6,10,14),this.QR(t,3,7,11,15),this.QR(t,0,5,10,15),this.QR(t,1,6,11,12),this.QR(t,2,7,8,13),this.QR(t,3,4,9,14);for(let t=0;t<16&&this.pointer+t<=i;t++)s=(e=this.data[this.pointer+t])^this.xstate[t]+this.state[t],this.pointer+t==i&&(s=s<<8*h>>>8*h),this.data[this.pointer+t]=s,this.domac&&(this.pmac[3&t]^=e+this.xstate[t],this.cmac[3&t]^=s+this.xstate[t],this.QR(this.pmac,3&t,t+1&3,t+2&3,t+3&3),this.QR(this.cmac,3&t,t+1&3,t+2&3,t+3&3));this.pointer+=16,this.state[15]++}}append(s){s="string"==typeof s?(new n).encode(s):s;let i=this.data,h=64*Math.ceil((this.sigbytes+s.byteLength)/64);this.data=new t(h),this.data.set(new t(i.buffer,0,this.sigbytes)),this.data.set(new t(s.buffer,s.byteOffset,s.byteLength),this.sigbytes),this.data=new e(this.data.buffer),this.sigbytes+=s.byteLength}update(t){return this.append(t),this.process(!1),this}finalize(){return this.process(!0),{data:new t(this.data.buffer,0,this.sigbytes),mac:this.getmac()}}}const f=new t([0,1,62,28,27,36,44,6,55,20,3,10,43,25,39,41,45,15,21,8,18,2,61,56,14]),l=new e([1,32898,32906,2147516416,32907,2147483649,2147516545,32777,138,136,2147516425,2147483658,2147516555,139,32905,32771,32770,128,32778,2147483658,2147516545,32896,2147483649,2147516424]),u=new t(25),w=new t(25),p=new t(25),b=new t(25),y=new t(25);let g,m;for(let t=0;t<25;t++)g=t%5,m=Math.floor(t/5),u[t]=(g+1)%5,w[t]=(g+4)%5,p[t]=5*m+(2*g+3*m)%5,b[t]=(g+1)%5*5+m,y[t]=(g+2)%5*5+m;class R{reset(){this.state=new e(25),this.temp=new e(25),this.theta=new e(5),this.data=new e(0),this.padblock=new e(16),this.padsigbytes=0,this.pointer=0}constructor(){this.reset()}keccakF(t){let e,s,n=this.temp,i=this.theta;for(let h=0;h<22;h++){i[0]=t[0]^t[1]^t[2]^t[3]^t[4],i[1]=t[5]^t[6]^t[7]^t[8]^t[9],i[2]=t[10]^t[11]^t[12]^t[13]^t[14],i[3]=t[15]^t[16]^t[17]^t[18]^t[19],i[4]=t[20]^t[21]^t[22]^t[23]^t[24];for(let h=0;h<25;h++)s=i[u[h]],t[h]^=i[w[h]]^(s<<1|s>>>31),e=f[h],s=t[h],n[p[h]]=s<<e|s>>>32-e;for(let e=0;e<25;e++)t[e]=n[e]^~n[b[e]]&n[y[e]];t[0]^=l[h]}}process(t=!1){let e=(this.data.length-this.pointer)/16;for(let t=0;t<e;t++){for(let t=0;t<16;t++)this.state[t]^=this.data[this.pointer+t];this.keccakF(this.state),this.pointer+=16}if(t){for(let t=0;t<16;t++)this.state[t]^=this.padblock[t];this.keccakF(this.state)}}append(s){s="string"==typeof s?(new n).encode(s):s;let i=this.data,h=this.padblock,r=this.padsigbytes;if(s.byteLength+r<64)(h=new t(h.buffer)).set(new t(s.buffer,s.byteOffset,s.byteLength),r),h[h.length-1]=128,h[s.byteLength+r]^=6,this.padblock=new e(h.buffer),this.padsigbytes+=s.byteLength;else{let n=r+s.byteLength>>6<<6,o=(r+s.byteLength)%64;(i=i.byteLength>=n?new t(i.buffer,0,n):new t(n)).set(new t(h.buffer,0,r)),i.set(new t(s.buffer,s.byteOffset,s.byteLength-o),r),this.data=new e(i.buffer,0,n>>2),h.fill(0),this.padsigbytes=0,o>0&&this.append(new t(s.buffer,s.byteLength-o))}}update(t){return this.append(t),this.process(!1),this}finalize(s=32){this.process(!0);let n=16*Math.ceil(s/64),i=new e(n);for(let t=0;t<n;t+=16)i.set(new e(this.state.buffer,0,16),t),this.keccakF(this.state);return{toString(t){return(new(t||o)).decode(this.hash)},hash:new t(i.buffer,0,s)}}}class Q{constructor(t=32,e=1e3){this.outputbytes=t,this.iterations=e}compute(s,n){let i,h=new t(this.outputbytes),r=new R;r.update(new e([n])),r.finalize(0);for(let t=0;t<this.iterations;t++){r.update(s),i=r.finalize(this.outputbytes).hash;for(let t=0;t<h.length;t++)h[t]^=i[t]}return h}}return{version:"1.2",author:"Franatrtur",enc:{Hex:o,Utf8:n,Ascii:s,Base64:a},ChaCha20:d,Keccak800:R,Pbkdf:Q,encrypt:function(s,i){let h="object"==typeof crypto?crypto.getRandomValues(new e(1))[0]:Math.floor(4294967296*Math.random()),r=new Q(32,1e3).compute((new n).encode(i),h),c=new d(r,!0,h);c.update((new n).encode(s));let f=c.finalize();return(new o).decode(new t(new e([h]).buffer))+(new a).decode(f.data)+(new o).decode(f.mac)},decrypt:function(t,s){let i,h,r;try{i=new e((new o).encode(t.slice(0,8)).buffer)[0],h=(new a).encode(t.slice(8,-32)),r=t.slice(-32)}catch(t){throw"Incorrectly formated ciphertext"}let c=new Q(32,1e3).compute((new n).encode(s),i),f=new d(c,!0,i);f.update(h);let l=f.finalize();if((new o).decode(l.mac)!=r)throw"Invalid authentication";return(new n).decode(l.data)},hash:function(t){return(new R).update((new n).encode(t)).finalize().toString(o)}}}());