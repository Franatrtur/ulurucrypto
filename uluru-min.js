/*
LICENSED UNDER THE MIT LICENSE: https://github.com/Franatrtur/ulurucrypto/blob/main/LICENSE
*/
!function(t,e){let n="object"==typeof window?window:global,s=Object.assign("object"==typeof n.Uluru?n.Uluru:n.Uluru={},t);"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=s)}(function(){const t=Uint8Array,e=Uint32Array;class n{encode(e){let n=new t(e.length);for(let t=0,s=e.length;t<s;t++)n[t]=e.charCodeAt(t);return n}decode(t){return String.fromCharCode(...t)}}class s{encode(t){return"function"==typeof TextEncoder?(new TextEncoder).encode(t):(new n).encode(unescape(encodeURIComponent(t)))}decode(t){return"function"==typeof TextDecoder?new TextDecoder("utf8").decode(t):decodeURIComponent(escape((new n).decode(t)))}}const i=t=>"string"==typeof t?(new s).encode(t):t,r=Array(256),o={};let a;for(let t=0;t<256;t++)a=("00"+t.toString(16)).slice(-2),r[t]=a,o[a]=t;class h{encode(e){let n=new t(e.length>>1);for(let t=0,s=e.length;t<s;t+=2)n[t>>1]=o[e.slice(t,t+2)];return n}decode(t){let e=[];for(let n=0,s=t.length;n<s;n++)e.push(r[t[n]]);return e.join("")}}class f{encode(t){return(new n).encode(atob(t))}decode(t){return btoa((new n).decode(t))}}const c=new e((new n).encode("expand 32-byte k").buffer);class l{reset(){this.xstate=new e(16),this.pmac=!!this.domac&&new e(c),this.cmac=!!this.domac&&new e(c),this.data=new e(0),this.pointer=0,this.sigbytes=0}constructor(t,n=!0,s=0,i=0){this.state=new e(16);let r=this.state;r.set(c),r.set(new e(t.buffer),4),r[13]=s;for(let t=0;t<8;t++){for(let t=0;t<4;t++)this.QR(r,t,t+4,t+8,t+12);for(let t=0;t<16;t+=4)this.QR(r,t,t+1,t+2,t+3)}this.prectr=r[15],r[15]^=i,this.ctr=i,this.domac=!!n,this.reset()}QR(t,e,n,s,i){t[e]+=t[n],t[i]^=t[e],t[i]=t[i]<<16|t[i]>>>16,t[s]+=t[i],t[n]^=t[s],t[n]=t[n]<<12|t[n]>>>20,t[e]+=t[n],t[i]^=t[e],t[i]=t[i]<<8|t[i]>>>24,t[s]+=t[i],t[n]^=t[s],t[n]=t[n]<<7|t[n]>>>25}getmac(){if(!this.domac)return!1;let n=this.pmac,s=this.cmac,i=new e([n[0]^s[0],n[1]^s[1],n[2]^s[2],n[3]^s[3]]);for(let t=0;t<4;t++)this.QR(i,0,1,2,3),this.QR(i,3,0,1,2),this.QR(i,2,3,0,1),this.QR(i,1,2,3,0);for(let t=0;t<4;t++)i[t]+=n[t]+s[t];return new t(i.buffer)}process(t=!1){let e,n,s=(t?Math.ceil:Math.floor)((this.sigbytes-this.pointer)/16),i=Math.ceil(this.sigbytes/4)-1,r=4-this.sigbytes%4;this.state[15]=this.prectr^this.ctr+(this.pointer>>4);for(let t=0;t<s;t++){let t=this.xstate;t.set(this.state);for(let e=0;e<20;e+=2)this.QR(t,0,4,8,12),this.QR(t,1,5,9,13),this.QR(t,2,6,10,14),this.QR(t,3,7,11,15),this.QR(t,0,5,10,15),this.QR(t,1,6,11,12),this.QR(t,2,7,8,13),this.QR(t,3,4,9,14);for(let t=0;t<16&&this.pointer+t<=i;t++)n=(e=this.data[this.pointer+t])^this.xstate[t]+this.state[t],this.pointer+t==i&&(n=n<<8*r>>>8*r),this.data[this.pointer+t]=n,this.domac&&(this.pmac[3&t]^=e+this.xstate[t],this.cmac[3&t]^=n+this.xstate[t],this.QR(this.pmac,3&t,t+1&3,t+2&3,t+3&3),this.QR(this.cmac,3&t,t+1&3,t+2&3,t+3&3));this.pointer+=16,this.state[15]++}}append(n){n=i(n);let s=this.data,r=64*Math.ceil((this.sigbytes+n.byteLength)/64);this.data=new t(r),this.data.set(new t(s.buffer,0,this.sigbytes)),this.data.set(new t(n.buffer,n.byteOffset,n.byteLength),this.sigbytes),this.data=new e(this.data.buffer),this.sigbytes+=n.byteLength}update(t){return this.append(t),this.process(!1),this}finalize(){return this.process(!0),{data:new t(this.data.buffer,0,this.sigbytes),mac:this.getmac()}}}const u=new t([0,1,62,28,27,36,44,6,55,20,3,10,43,25,39,41,45,15,21,8,18,2,61,56,14]),d=new e([1,32898,32906,2147516416,32907,2147483649,2147516545,32777,138,136,2147516425,2147483658,2147516555,139,32905,32771,32770,128,32778,2147483658,2147516545,32896,2147483649,2147516424]),p=new t(25),w=new t(25),b=new t(25),g=new t(25),y=new t(25);let m,R;for(let t=0;t<25;t++)m=t%5,R=Math.floor(t/5),p[t]=(m+1)%5,w[t]=(m+4)%5,b[t]=5*R+(2*m+3*R)%5,g[t]=(m+1)%5*5+R,y[t]=(m+2)%5*5+R;class L{reset(){this.state=new e(25),this.temp=new e(25),this.theta=new e(5),this.data=new e(0),this.padblock=new e(16),this.padsigbytes=0,this.pointer=0}constructor(){this.reset()}keccakF(t){let e,n,s=this.temp,i=this.theta;for(let r=0;r<22;r++){i[0]=t[0]^t[1]^t[2]^t[3]^t[4],i[1]=t[5]^t[6]^t[7]^t[8]^t[9],i[2]=t[10]^t[11]^t[12]^t[13]^t[14],i[3]=t[15]^t[16]^t[17]^t[18]^t[19],i[4]=t[20]^t[21]^t[22]^t[23]^t[24];for(let r=0;r<25;r++)n=i[p[r]],t[r]^=i[w[r]]^(n<<1|n>>>31),e=u[r],n=t[r],s[b[r]]=n<<e|n>>>32-e;for(let e=0;e<25;e++)t[e]=s[e]^~s[g[e]]&s[y[e]];t[0]^=d[r]}}process(t=!1){let e=(this.data.length-this.pointer)/16;for(let t=0;t<e;t++){for(let t=0;t<16;t++)this.state[t]^=this.data[this.pointer+t];this.keccakF(this.state),this.pointer+=16}if(t){for(let t=0;t<16;t++)this.state[t]^=this.padblock[t];this.keccakF(this.state)}}append(n){n=i(n);let s=this.data,r=this.padblock,o=this.padsigbytes;if(n.byteLength+o<64)(r=new t(r.buffer)).set(new t(n.buffer,n.byteOffset,n.byteLength),o),r[r.length-1]=128,r[n.byteLength+o]^=6,this.padblock=new e(r.buffer),this.padsigbytes+=n.byteLength;else{let i=o+n.byteLength>>6<<6,a=(o+n.byteLength)%64;(s=s.byteLength>i?new t(s.buffer,0,i):new t(i)).set(new t(r.buffer,0,o)),s.set(new t(n.buffer,n.byteOffset,n.byteLength-a),o),this.data=new e(s.buffer,0,i>>2),r.fill(0),this.padsigbytes=0,a>0&&this.append(new t(n.buffer,n.byteOffset+n.byteLength-a,a))}}update(t){return this.append(t),this.process(!1),this}finalize(n=32){this.process(!0);let s=16*Math.ceil(n/64),i=new e(s);for(let t=0;t<s;t+=16)i.set(new e(this.state.buffer,0,16),t),this.keccakF(this.state);return{toString(t){return(new(t||h)).decode(this.hash)},hash:new t(i.buffer,0,n)}}}class U{constructor(t=32,e=1e3){this.outputbytes=t,this.iterations=e}compute(n,s){let i,r=new t(this.outputbytes),o=new L;o.update(new e([s])),o.finalize(0);for(let t=0;t<this.iterations;t++){o.update(n),i=o.finalize(this.outputbytes).hash;for(let t=0;t<r.length;t++)r[t]^=i[t]}return{result:r}}}const E=BigInt,M=E(1),Q=E(0),k=t=>(M<<E(t))-M;function x(t){let e=0,n=E(4294967296),s=!0;for(;t;)e+=(s=s&&t>n)?32:1,t>>=E(s?32:1);return e}function z(t,e,n){let s=M;for(;e;)(e&M)==M&&(s=s*t%n),e>>=M,t=t*t%n;return s}function S(t){let n=Q,s="object"==typeof crypto?()=>crypto.getRandomValues(new e(1))[0]:Math.random;for(var i=0;32*i<t;i++)n=n<<E(32)|E(s());return n&k(t)}let A=[E(2)];t:for(let t=3;t<1024;t+=2){for(let e=1;e<A.length;e++)if(E(t)%A[e]===BigInt(0))continue t;A.push(E(t))}function I(t,e=6){let n,s=Math.min(16,x(t)-1);for(;e--;)if(z(n=S(s)+E(5),t-M,t)!=M)return!1;return!0}function j(t,e=6){let n,s,i=Q,r=t-M,o=Math.min(16,x(t)-1);for(;(r&M)==M;)r>>=M,i++;let a=M,h=t-M;t:for(;e--;)if((s=z(n=S(o)+E(5),r,t))!=a&&s!=h){for(let e=Q,n=i-M;e<n;e++){if((s=z(s,E(2),t))==a)return!1;if(s==h)continue t}return!1}return!0}function C(t,e=6){for(let e=0,n=A.length;e<n;e++)if(t%A[e]==Q)return t==A[e];return j(t,e)&&I(t,e)}function B(t,e=6,n=1e5){let s;for(let i=0;i<n;i++)if(C(s=S(t)|M|M<<E(t-1),e))return s;throw"Cannot find a prime"}function O(t,e){let n,s,i=e,r=Q,o=M;for(;t>1;)n=t/e,s=e,e=t%e,t=s,s=r,r=o-n*r,o=s;return o<0?o+i:o}function v(e){return E("0x"+(new h).decode(new t(e.buffer,e.byteOffset||0,e.byteLength||0)))}function P(t){let e=t.toString(16);return(new h).encode((e.length%2==1?"0":"")+e)}function K(...e){let n=0;for(let t=0;t<e.length;t++)n+=e[t].byteLength;let s=new Uint8Array(n),i=0;for(let n=0;n<e.length;n++)s.set(new t(e[n].buffer,e[n].byteOffset,e[n].byteLength),i),i+=e[n].byteLength;return s}const V=12,T=16,D=V+T+4;class F{pad(n,s){let i=new t(s-D);i.set(n);let r=new e([n.byteLength]),o=crypto.getRandomValues(new t(V)),a=K(r,o,(new L).update(i).update(r).update(o).finalize(T).hash),h=(new L).update(a).finalize(s-D).hash;for(let t=0;t<s-D;t++)i[t]^=h[t];h=(new L).update(i).finalize(D).hash;for(let t=0;t<D;t++)a[t]^=h[t];return{data:K(a,i)}}unpad(n){let s=n.byteLength,i=new t(n.buffer,0,D).slice(),r=new t(n.buffer,D).slice(),o=(new L).update(r).finalize(D).hash;for(let t=0;t<D;t++)i[t]^=o[t];o=(new L).update(i).finalize(s-D).hash;for(let t=0;t<s-D;t++)r[t]^=o[t];let a=new e(i.buffer,0,1),h=new t(i.buffer,4,V),f=new t(i.buffer,4+V,T);if((new L).update(r).update(a).update(h).finalize(T).hash.join(",")!=f.join(","))throw"OAEP invalid padding hash";return{data:new t(r.buffer,0,a[0])}}}class N{static fromBufferViews(t,e){return new this(v(t),v(e))}static fromString(t){let e=t.split("<")[1].split(">")[0].split("|");return this.fromBufferView((new f).encode(e[0]),(new f).encode(e[1]))}constructor(t,e){this.E=E(t),this.M=E(e)}toString(){return"<"+(new f).decode(P(this.E))+"|"+(new f).decode(P(this.M))+">"}process(t){let e=v(t);if(e>=this.M)throw"Data integer too large";return P(z(e,this.E,this.M))}encrypt(t){t=i(t);let e=(x(this.M)>>3)-2-D;if(t.byteLength>e)throw"Message too long";return{data:this.process((new F).pad(t,e).data)}}decrypt(t){return{data:(new F).unpad(this.process(t)).data}}sign(t){t=i(t);(new L).update(t).finalize(64).hash;return{data:t,signature:this.encrypt(t).data}}verify(t,e){t=i(t);let n=(new L).update(t).finalize(64).hash,s=this.decrypt(e).data;return n.join(",")==s.join(",")}}const Y=E(257),G=["\n==BEGIN ULURU PUBLIC KEY==\n","\n==END ULURU PUBLIC KEY==\n"],H=["\n==BEGIN ULURU PRIVATE KEY==\n","\n==END ULURU PRIVATE KEY==\n"];return{version:"2.0",author:"Franatrtur",enc:{Hex:h,Utf8:s,Ascii:n,Base64:f},ChaCha20:l,Keccak800:L,Pbkdf:U,OAEP:F,RSAKey:N,RSAKeyPair:class{static fromString(t){return new this(N.fromString(t.split(G[0])[1].split(G[1])[0]),N.fromString(t.split(H[0])[1].split(H[1])[0]))}static generate(t){if(!t)return;let e=Y,n=B(t>>=1),s=B(t),i=n*s,r=O(e,(n-M)*(s-M));return new this(new N(e,i),new N(r,i))}constructor(t,e){this.public=t,this.private=e}toString(){return G[0]+this.public.toString()+G[1]+"\n"+H[0]+this.private.toString()+H[1]}},encrypt:function(n,i){let r="object"==typeof crypto?crypto.getRandomValues(new e(1))[0]:Math.floor(4294967296*Math.random()),o=new U(32,1e3).compute((new s).encode(i),r).result,a=new l(o,!0,r);a.update((new s).encode(n));let c=a.finalize();return(new h).decode(new t(new e([r]).buffer))+(new f).decode(c.data)+(new h).decode(c.mac)},decrypt:function(t,n){let i,r,o;try{i=new e((new h).encode(t.slice(0,8)).buffer)[0],r=(new f).encode(t.slice(8,-32)),o=t.slice(-32)}catch(t){throw"Incorrectly formated ciphertext"}let a=new U(32,1e3).compute((new s).encode(n),i).result,c=new l(a,!0,i);c.update(r);let u=c.finalize();if((new h).decode(u.mac)!=o)throw"Invalid authentication";return(new s).decode(u.data)},hash:function(t){return(new L).update((new s).encode(t)).finalize().toString(h)},utils:[o,r,Y,V,T,D,A,K,P,v,S,x,k,O,z,I,j,C,B]}}());